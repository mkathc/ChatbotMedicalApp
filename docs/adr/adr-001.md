# ADR-001: Modelo de interacción — Hybrid Assistant (Conversación + UI determinística)

## Estado
Propuesto (PoC)

## Contexto
El reto requiere un asistente conversacional integrado en una app móvil de salud, donde el usuario accede a funcionalidades mediante lenguaje natural sin navegar múltiples pantallas. Además, el sistema debe operar en condiciones de alta concurrencia, conectividad variable (3G/intermitente), y manejar datos sensibles (PHI). También se exige que funcionalidades críticas como el triaje inicial puedan operar offline cuando no hay conectividad.

Capacidades funcionales requeridas:
- Triaje de síntomas con sugerencia de siguiente acción (emergencia, agendar cita, autocuidado).
- Agendamiento de citas: buscar disponibilidad, reservar, modificar y cancelar “mediante conversación”.
- Consulta de información médica (historial, exámenes, recetas).
- Gestión de recordatorios.

Riesgos y tensiones principales:
- Salud/PHI implica necesidad de explicabilidad, confirmación explícita en acciones críticas y minimización de fallos.
- Conectividad variable exige degradación elegante: el sistema debe seguir siendo útil sin IA o sin red.
- La interpretación libre por un LLM no es determinística y puede generar resultados no confiables en tareas clínicas o transaccionales.

## Decisión
Adoptar un **Hybrid Assistant** como modelo de interacción:

1) **Conversación como interfaz principal**
- El usuario inicia y conduce flujos mediante texto en lenguaje natural (voz fuera de alcance del MVP; puede añadirse a futuro).
- La conversación se utiliza para:
    - detección de intención (routing),
    - captura progresiva de parámetros,
    - confirmaciones simples.

2) **UI determinística para pasos críticos o complejos**
- Para operaciones transaccionales y de alto impacto, se usa UI nativa como apoyo determinístico:
    - **Crear y modificar citas**: requieren una pantalla de resumen con botón explícito de confirmación.
    - **Cancelar citas**: confirmación simple “Sí/No” en el chat (tras identificar la cita a cancelar).
- Para selección de opciones complejas (p. ej., slots de horarios), se permite UI guiada (lista/calendario).

3) **Triaje con clasificación determinística, incluso offline**
- La clasificación (emergencia / agendar cita / autocuidado) se realiza mediante reglas mínimas y determinísticas.
- En modo offline, el triaje ofrece **solo** clasificación y guidance básico (p. ej. “acude a emergencias”), evitando recomendaciones extensas dependientes de información externa.
- El asistente conversacional explica el resultado y sus límites (“no es diagnóstico”).

4) **Degradación elegante**
- Si la IA/servicios no están disponibles, el sistema:
    - mantiene flujos guiados,
    - solicita información mínima necesaria,
    - aplica reglas locales donde aplique (triaje),
    - informa al usuario y sugiere alternativas (reintento, continuar manualmente).

## Alternativas consideradas
1) **Chatbot “puro” (todo conversacional, sin UI determinística)**
- Pros: UX “mágica” y mínima navegación.
- Contras: menor control y validabilidad; alto riesgo de ambigüedad; difícil garantizar offline; mayor riesgo en acciones críticas.

2) **UI guiada sin NLP (solo formularios / flows)**
- Pros: máxima predictibilidad; fácil de testear.
- Contras: no cumple el objetivo de “interfaz inteligente” por lenguaje natural; mayor fricción de navegación.

3) **Backend-first (toda la inteligencia y estado en backend; clientes delgados)**
- Pros: cambios rápidos sin releases; centraliza lógica.
- Contras: dependencia fuerte de conectividad (3G/intermitente); complica requisito de triaje offline; aumenta latencia percibida.

## Trade-offs
### Beneficios
- **Seguridad y control**: pasos críticos se confirman en UI determinística.
- **Resiliencia**: triaje básico disponible offline; degradación elegante sin IA/red.
- **Baja complejidad cognitiva**: separa claramente “intención conversacional” de “ejecución determinística”.
- **Mantenibilidad**: contratos explícitos entre conversación/orquestación y módulos de dominio.

### Costos / Riesgos
- UX menos “100% conversacional” en operaciones críticas (hay transiciones a UI).
- Mayor esfuerzo de diseño de estados (conversación ↔ UI) y consistencia de experiencia.
- Requiere definir claramente límites de responsabilidad del NLP vs reglas determinísticas.

## Consecuencias
- Se definirán contratos de “Intents” y “Actions” (ej. `ScheduleAppointment`, `CancelAppointment`, `RunTriage`) para desacoplar la conversación del dominio.
- Los módulos de dominio (triaje, citas, info médica, recordatorios) expondrán interfaces simples (deep modules).
- Se implementarán estrategias de fallback:
    - reglas mínimas offline para triaje,
    - confirmaciones explícitas,
    - mensajes de error y reintento en conectividad variable.
- La voz se declara fuera de alcance del MVP; la arquitectura debe permitir añadirla como canal alternativo en el futuro.
